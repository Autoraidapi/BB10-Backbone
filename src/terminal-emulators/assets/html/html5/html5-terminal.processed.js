var util=util||{};function Sound(e){var t=this,n=null,i=null,o=e||!1;window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioContext&&(n=new window.AudioContext),this.load=function(e,i,o){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){n&&n.decodeAudioData(this.response,(function(e){t.sample=e,o&&o()}),(function(e){console.log(e)}))},r.send()},this.play=function(){n&&((i=n.createBufferSource()).buffer=t.sample,i.looping=o,i.connect(n.destination),i.noteOn(0))},this.stop=function(){i&&(i.noteOff(0),i.disconnect(0))}}util.toArray=function(e){return Array.prototype.slice.call(e||[],0)},util.getDocHeight=function(){var e=document;return Math.max(Math.max(e.body.scrollHeight,e.documentElement.scrollHeight),Math.max(e.body.offsetHeight,e.documentElement.offsetHeight),Math.max(e.body.clientHeight,e.documentElement.clientHeight))};var Terminal=Terminal||function(e){window.URL=window.URL||window.webkitURL,window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem;const t="1.0.0",n=["3d","cat","cd","cp","clear","date","help","install","ls","mkdir","mv","open","pwd","rm","rmdir","theme","version","who","wget"],i=["default","cream"];var o=null,r=null,a=[],c=0,s=0,l=null,d=null,u=null,f=!1,m=new Worker("https://000456207.deployed.codepen.website/assets/html/html5/html5-worker.js");m.onmessage=function(e){var t=e.data;t.entries&&u.contentWindow.postMessage({cmd:"build",data:t.entries},window.location.origin),t.msg&&D("<div>"+t.msg+"</div>")},m.onerror=function(e){console.log(e)};var h=document.getElementById(e);h.insertAdjacentHTML("beforeEnd",["<output></output>",'<div id="input-line" class="input-line">','<div class="prompt">$&gt;</div><div><input class="cmdline" autofocus /></div>',"</div>"].join(""));var p=h.querySelector("#input-line .cmdline"),v=h.querySelector("output"),g=document.querySelector(".interlace"),E=new Sound(!1);function y(e,t,n){e.code==FileError.NOT_FOUND_ERR?D(t+": "+n+": No such file or directory<br>"):e.code==FileError.INVALID_STATE_ERR?D(t+": "+n+": Not a directory<br>"):e.code==FileError.INVALID_MODIFICATION_ERR?D(t+": "+n+": File already exists<br>"):w(e)}function w(e){var t="";switch(e.code){case FileError.QUOTA_EXCEEDED_ERR:t="QUOTA_EXCEEDED_ERR";break;case FileError.NOT_FOUND_ERR:t="NOT_FOUND_ERR";break;case FileError.SECURITY_ERR:t="SECURITY_ERR";break;case FileError.INVALID_MODIFICATION_ERR:t="INVALID_MODIFICATION_ERR";break;case FileError.INVALID_STATE_ERR:t="INVALID_STATE_ERR";break;default:t="Unknown Error"}D("<div>Error: "+t+"</div>")}function b(e,t,n){var i=n||w;e.getDirectory(t[0],{create:!0},(function(e){t.length&&b(e,t.slice(1))}),i)}function R(e){v.innerHTML="",e.value="",document.documentElement.style.height="100%",g.style.height="100%"}function k(e){document.location.pathname;if(!e||"default"==e)return localStorage.removeItem("theme"),void(document.body.className="");e&&(document.body.classList.add(e),localStorage.theme=e)}function T(){var e=document.body;if(e.classList.toggle("offscreen"),f=!f,e.classList.contains("offscreen")){h.style.webkitTransform="translateY("+(util.getDocHeight()-175)+"px)";var t=function(n){var i=document.createElement("iframe");i.id="fsn",i.src="../fsn/fsn_proto.html",u=e.insertBefore(i,e.firstElementChild),i.contentWindow.onload=function(){m.postMessage({cmd:"read",type:type_,size:size_})},h.removeEventListener("webkitTransitionEnd",t,!1)};h.addEventListener("webkitTransitionEnd",t,!1)}else h.style.webkitTransform="translateY(0)",e.removeChild(u),u=null}function D(e){v.insertAdjacentHTML("beforeEnd",e),p.scrollIntoView()}return E.load("beep.mp3",!1),v.addEventListener("DOMSubtreeModified",(function(e){var t=util.getDocHeight();document.documentElement.style.height=t+"px",g.style.height=t+"px",setTimeout((function(){p.scrollIntoView()}),0)}),!1),v.addEventListener("click",(function(e){var t=e.target;(t.classList.contains("file")||t.classList.contains("folder"))&&(p.value+=" "+t.textContent)}),!1),window.addEventListener("click",(function(e){p.focus()}),!1),p.addEventListener("click",(function(e){this.value=this.value}),!1),p.addEventListener("keydown",(function(e){(e.ctrlKey||e.metaKey)&&83==e.keyCode&&(h.classList.toggle("flicker"),D("<div>Screen flicker: "+(h.classList.contains("flicker")?"on":"off")+"</div>"),e.preventDefault(),e.stopPropagation())}),!1),p.addEventListener("keyup",(function(e){a.length&&(38!=e.keyCode&&40!=e.keyCode||(a[c]?a[c]=this.value:s=this.value),38==e.keyCode?--c<0&&(c=0):40==e.keyCode&&++c>a.length&&(c=a.length),38!=e.keyCode&&40!=e.keyCode||(this.value=a[c]?a[c]:s,this.value=this.value))}),!1),p.addEventListener("keydown",(function(e){if(!this.value&&8==e.keyCode)return E.stop(),void E.play();if(9==e.keyCode)e.preventDefault();else if(13==e.keyCode){this.value&&(a[a.length]=this.value,c=a.length);var s=this.parentNode.parentNode.cloneNode(!0);s.removeAttribute("id"),s.classList.add("line");var h=s.querySelector("input.cmdline");if(h.autofocus=!1,h.readOnly=!0,v.appendChild(s),this.value&&this.value.trim()){var p=this.value.split(" ").filter((function(e,t){return e})),g=p[0].toLowerCase();p=p.splice(1)}switch(g){case"3d":R(this),D("Hold on to your butts!"),T();break;case"cat":if(!(O=p.join(" "))){D("usage: "+g+" filename");break}!function(e,t,n){if(!o)return;r.getFile(t,{},(function(e){e.file((function(e){var t=new FileReader;t.onloadend=function(e){n(this.result)},t.readAsText(e)}),w)}),(function(n){n.code==FileError.INVALID_STATE_ERR?D(e+": "+t+": is a directory<br>"):n.code==FileError.NOT_FOUND_ERR&&D(e+": "+t+": No such file or directory<br>")}))}(g,O,(function(e){D("<pre>"+e+"</pre>")}));break;case"clear":return void R(this);case"date":D((new Date).toLocaleString());break;case"exit":f&&T(),null!=l&&(d.stop(),clearInterval(l));break;case"help":D('<div class="ls-files">'+n.join("<br>")+"</div>"),D("<p>Add files by dragging them from your desktop.</p>");break;case"install":if(window.chrome&&window.chrome.app)if(window.chrome.app.isInstalled)D("This app is already installed.");else try{chrome.app.install()}catch(e){alert(e+"\nEnable is about:flags")}break;case"ls":!function(e){if(!o)return;var t=[],n=r.createReader(),i=function(){n.readEntries((function(n){n.length?(t=t.concat(util.toArray(n)),i()):(t=t.sort(),e(t))}),w)};i()}((function(e){if(e.length){var t=function(e){var t=e[0].name;util.toArray(e).forEach((function(e,n){e.name.length>t.length&&(t=e.name)}));var n=1==e.length?"height: "+30*e.length+"px;":e.length<=3?"height: "+18*e.length+"px;":"";return['<div class="ls-files" style="-webkit-column-width:',16*t.length,"px;",n,'">']}(e);util.toArray(e).forEach((function(e,n){t.push('<span class="',e.isDirectory?"folder":"file",'">',e.name,"</span><br>")})),t.push("</div>"),D(t.join(""))}}));break;case"pwd":D(r.fullPath);break;case"cd":var _=p.join(" ")||"/";r.getDirectory(_,{},(function(e){r=e,D("<div>"+e.fullPath+"</div>"),u&&u.contentWindow.postMessage({cmd:"cd",data:_},location.origin)}),(function(e){y(e,g,_)}));break;case"mkdir":var I=!1,A=p.indexOf("-p");if(-1!=A&&(p.splice(A,1),I=!0),!p.length){D("usage: "+g+" [-p] directory<br>");break}p.forEach((function(e,t){if(I){var n=e.split("/");"."!=n[0]&&""!=n[0]||(n=n.slice(1)),b(r,n)}else r.getDirectory(e,{create:!0,exclusive:!0},(function(){u&&u.contentWindow.postMessage({cmd:"mkdir",data:e},location.origin)}),(function(t){y(t,g,e)}))}));break;case"cp":case"mv":var F=p[0];_=p[1];if(!F||!_){D(["usage: ",g," source target<br>","&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",g," source directory/"].join(""));break}var L=function(e,t,n,i){var o=i||null;"mv"==e?t.moveTo(n,o):t.copyTo(n,o)};"/"==_[_.length-1]?r.getDirectory(F,{},(function(e){var t=-1==[".","./","..","../","/"].indexOf(_);r.getDirectory(_,{create:t},(function(t){L(g,e,t)}),w)}),(function(e){r.getFile(F,{},(function(e){r.getDirectory(_,{},(function(t){L(g,e,t)}),w)}),w)})):r.getFile(F,{},(function(e){e.getParent((function(t){L(g,e,t,_)}),w)}),w);break;case"open":var O;if(!(O=p.join(" "))){D("usage: "+g+" filename");break}!function(e,t,n){if(!o)return;r.getFile(t,{},n,(function(n){n.code==FileError.NOT_FOUND_ERR&&D(e+": "+t+": No such file or directory<br>")}))}(g,O,(function(e){window.open(e.toURL(),"mywin")}));break;case"init":m&&m.postMessage({cmd:"init",type:type_,size:size_});break;case"rm":var S=!1;["-r","-f","-rf","-fr"].forEach((function(e,t){var n=p.indexOf(e);-1!=n&&(p.splice(n,1),S=!0)})),p.forEach((function(e,t){r.getFile(e,{},(function(t){t.remove((function(){u&&u.contentWindow.postMessage({cmd:"rm",data:e},location.origin)}),w)}),(function(t){S&&t.code==FileError.TYPE_MISMATCH_ERR?r.getDirectory(e,{},(function(e){e.removeRecursively(null,w)}),w):t.code==FileError.INVALID_STATE_ERR?D(g+": "+e+": is a directory<br>"):w(t)}))}));break;case"rmdir":p.forEach((function(e,t){r.getDirectory(e,{},(function(t){t.remove((function(){u&&u.contentWindow.postMessage({cmd:"rm",data:e},location.origin)}),(function(t){t.code==FileError.INVALID_MODIFICATION_ERR?D(g+": "+e+": Directory not empty<br>"):w(t)}))}),(function(t){y(t,g,e)}))}));break;case"sudo":null!=l&&(d.stop(),clearInterval(l)),d?d.play():(d=new Sound(!0)).load("magic_word.mp3",!1,(function(){d.play()})),l=setInterval((function(){D("<div>YOU DIDN'T SAY THE MAGIC WORD!</div>")}),100);break;case"theme":var C=p.join(" ");C?-1!=i.indexOf(C)?k(C):D("Error - Unrecognized theme used"):D(["usage: ",g," "+i.join(",")].join(""));break;case"version":case"ver":D(t);break;case"wget":var N=p[0];if(!N){D(["usage: ",g," missing URL"].join(""));break}-1==N.search("^http://")&&(N="http://"+N);var x=new XMLHttpRequest;x.onload=function(e){200==this.status&&4==this.readyState?D("<textarea>"+this.response+"</textarea>"):D("ERROR: "+this.status+" "+this.statusText)},x.onerror=function(e){D("ERROR: "+this.status+" "+this.statusText),D("Could not fetch "+N)},x.open("GET",N,!0),x.send();break;case"who":D(document.title+" - By: Eric Bidelman &lt;ericbidelman@chromium.org&gt;");break;default:g&&D(g+": command not found")}this.value=""}}),!1),{initFS:function(e,t){if(D("<div>Welcome to "+document.title+"! (v"+"1.0.0)</div>"),D((new Date).toLocaleString()),D('<p>Documentation: type "help"</p>'),window.requestFileSystem){var n=e?window.PERSISTENT:window.TEMPORARY;window.requestFileSystem(n,t,(function(e){r=(o=e).root,type_=n,size_=t,r.getDirectory("testquotaforfsfolder",{create:!0},(function(e){e.remove((function(){}))}),(function(e){e.code==FileError.QUOTA_EXCEEDED_ERR?(D("ERROR: Write access to the FileSystem is unavailable.<br>"),D('Type "install" or run Chrome with the --unlimited-quota-for-files flag.')):w(e)}))}),w)}else D("<div>Sorry! The FileSystem APIs are not available in your browser.</div>")},output:D,setTheme:k,getCmdLine:function(){return p},addDroppedFiles:function(e){util.toArray(e).forEach((function(e,t){r.getFile(e.name,{create:!0,exclusive:!0},(function(t){u&&u.contentWindow.postMessage({cmd:"touch",data:e.name},location.origin),t.createWriter((function(t){t.write(e)}),w)}),w)}))},toggle3DView:T,selectFile:function(e){alert(e)}}};